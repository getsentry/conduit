# Ignored by docker compose, used by devservices
x-sentry-service-config:
  version: 0.1
  service_name: conduit
  dependencies:
    redis:
      description: Shared instance of redis used by sentry services
      remote:
        repo_name: sentry-shared-redis
        branch: main
        repo_link: https://github.com/getsentry/sentry-shared-redis
    gateway:
      description: Conduit gateway service
    publish:
      description: Conduit publish service
  modes:
    default: [redis]
    containerized: [redis, gateway, publish]

x-programs:
  devserver:
    command: cargo run --bin gateway && cargo run --bin publish

services:
  gateway:
    image: ghcr.io/getsentry/conduit-gateway:latest
    ports:
      - 127.0.0.1:8000:8000
    networks:
      - devservices
    labels:
      - orchestrator=devservices
    restart: unless-stopped
    platform: linux/amd64
  publish:
    image: ghcr.io/getsentry/conduit-publish:latest
    ports:
      - 127.0.0.1:8001:8001
    networks:
      - devservices
    labels:
      - orchestrator=devservices
    restart: unless-stopped
    platform: linux/amd64

networks:
  devservices:
    name: devservices
    external: true
